<!doctype html>
<html>
<head><meta charset="utf-8"/>
<title>TextGUI</title>
<style>
body {
	background-color: black;
	margin: 0;
	overflow: hidden;
}
canvas {
}
</style>
</head>
<body>
<canvas/>
<script>
function $(selector) { return document.querySelector(selector) }
let canvas = $("canvas");
let ctx = canvas.getContext("2d");

class View {
	constructor(l, t, w, h) {
		this.left = l;
		this.top = t;
		this.width = w;
		this.height = h;
	}

	x(i) { return canvas.MX + (this.left + i) * canvas.TX }
	y(j) { return canvas.MY + (this.top  + j) * canvas.TY }
	get w() { return this.width * canvas.TX }
	get h() { return this.height * canvas.TY }
	get x0() { return this.x(0) }
	get y0() { return this.y(0) }
	get x1() { return this.x(this.width) - 1 }
	get y1() { return this.y(this.height) - 1 }

	draw() {
		if (this.backgroundColor) {
			ctx.fillStyle = this.backgroundColor;
			ctx.fillRect(this.x0, this.y0, this.w, this.h);
		}
		if (this.title) {
			let tt = "â˜° " + this.title;
			ctx.fillStyle = this.color || "black";
			for (let i = 0; i < tt.length; ++i) {
				if (i >= this.width) break;
				// console.log(this.title.charAt(i));
				putc(tt.charAt(i), this.left + i, this.top);
			}
			ctx.fillRect(this.x0, this.y(1)+2, this.w, 1);
		}
	}

}

let VIEWS = [];

let v = new View(10, 10, 10, 5);
v.backgroundColor = randColor(0.8);
v.title = "Window1";
VIEWS.push(v);

function putc(c, i, j, color) {
	// ctx.fillStyle = color;
	ctx.fillText(c, canvas.MX + i * canvas.TX, canvas.MY + (j+1) * canvas.TY);
}

function random(x, y, z) {
	return Math.abs(Math.sin((x||0) * 8872.2831 + (y||0) * 1258.9823 + (z||0) * 5982.1225) * 89237.9578) % 1;
}

function hsv2rgb(h, s, v) {
  var r, g, b;

  var i = Math.floor(h * 6);
  var f = h * 6 - i;
  var p = v * (1 - s);
  var q = v * (1 - f * s);
  var t = v * (1 - (1 - f) * s);

  switch (i % 6) {
    case 0: r = v, g = t, b = p; break;
    case 1: r = q, g = v, b = p; break;
    case 2: r = p, g = v, b = t; break;
    case 3: r = p, g = q, b = v; break;
    case 4: r = t, g = p, b = v; break;
    case 5: r = v, g = p, b = q; break;
  }

  return [r,g,b].map(c => Math.floor(c * 256));
}

function randColor(v) {
	let rgb = hsv2rgb(Math.random(), Math.random(), v);
	return `rgb(${rgb.join(",")})`;
}

function rgb(rgb) {
	return `rgb(${rgb.join(",")})`;
}

function resize() {
	canvas.width = window.innerWidth;
	canvas.height = window.innerHeight;
	let F = 20;
	ctx.font = `${F}px Inconsolata, monospace`;
	canvas.TX = ctx.measureText("X").width + 1;  // 11
	canvas.TY = F;
	canvas.NX = Math.floor(canvas.width / canvas.TX);
	canvas.NY = Math.floor(canvas.height / canvas.TY);
	canvas.MX = 2;
	canvas.MY = 0;
	draw();
}

function draw() {
	let alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
	alphabet += alphabet.toLowerCase();
	alphabet += "0123456789";
	alphabet += "~!@#$%^&*()-_=+[{]}|;:,<.>/?";
	let now = +new Date();
	ctx.clearRect(0, 0, canvas.width, canvas.height);
	for (let i = 0; i < canvas.NX; ++i)
	for (let j = 0; j < canvas.NY; ++j) {
		let c = random(i,j,821.91 + now/1e15);
		if (c < 2/3) {
			c *= 3/2;
			// let v = ((i + j) % 20 < 10) ? 0.4 : 0.8;
			let v = Math.sin(now/-500 + (i + j) / 3) * 0.2 + 0.6;
			ctx.fillStyle = rgb(hsv2rgb(random(i,j,291.2),random(i,j,959.4), v));
			c = alphabet.charAt(Math.floor(alphabet.length * c));
			putc(c, i, j);
		}
	}

	for (v of VIEWS) {
		v.draw();
	}
}

window.addEventListener("resize", resize);
window.addEventListener("load", () => {
	resize();
	tick();
});

function tick() {
	window.requestAnimationFrame(tick);
	draw();
}

</script>